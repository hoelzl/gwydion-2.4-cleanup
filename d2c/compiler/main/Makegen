open(FILELOC,">$srcdir/file-locations.dylan")
    || die "cannot create file-locations.dylan";
## double any backslashes that might for some reason appear in the destdir.
$munged_destdir = $default_DYLANDIR || $destdir;
$munged_destdir =~ s/\\/\\\\/g;
$munged_destuserdir = $sitelibdirprefix;
$munged_destuserdir =~ s/\\/\\\\/g;
$GC_CFLAGS =~ s/\\/\\\\/g;
$GC_LIBS =~ s/\\/\\\\/g;
print FILELOC <<"EOF";
Module: main
Note: this file is generated by gen-makefile from Makegen

define constant \$default-dylan-dir = "$munged_destdir";
define constant \$default-dylan-user-dir = "$munged_destuserdir";

define constant \$gc-libs = "$GC_LIBS";

define constant \$default-target-name = "$target_name";
EOF
close(FILELOC);

open(VERSION,">$srcdir/version.dylan")
    || die "cannot create version.dylan";
print VERSION <<"EOF";
Module: main
Note: this file is generated by gen-makefile from Makegen

define constant \$version = "$version";
define constant \$bootstrap-counter = $bootstrap_counter;
EOF
close(VERSION);

&makegen_include("../common-Makegen");

$CPPFLAGS = "$CPPFLAGS -I../../runtime ";
$D2CFLAGS         # added by update-libdirs
    = $d2c_runtime
    . ' -L../../../common/collection-extensions'
    . ' -L../../../common/table-ext'
    . ' -L../../../common/string-ext'
    . ' -L../../runtime/random'
    . ' -L../../../common/streams'
    . ' -L../../../common/print'
    . ' -L../../../common/format'
    . ' -L../../../common/getopt'
    . ' -L../../../common/standard-io'
    . ' -L../../../common/regular-expressions'
    . ' -L../../../common/base-file-system'
    . ' -L../base'
    . ' -L../front'
    . ' -L../fer-transform'
    . ' -L../optimize'
    . ' -L../parser'
    . ' -L../../../common/stream-ext'
    . ' -L../convert'
    . ' -L../cback';

@potential_targets = &d2c_library('Main', '');

&emit_dbc_link_rule
    ('d2c.dbc', 
     '../../../common/base-file-system/base-file-system-lib.dbc '
     . '../base/compiler-base-lib.dbc ../front/compiler-front-lib.dbc'
     . ' ../fer-transform/compiler-fer-transform-lib.dbc'
     . ' ../optimize/compiler-optimize-lib.dbc '
     . ' ../parser/compiler-parser-lib.dbc ../convert/compiler-convert-lib.dbc'
     . ' ../cback/compiler-cback-lib.dbc compiler-main-lib.dbc');

if ($enable_mindy_bootstrap) {
    push(@compile_dependencies, 'd2c.dbc');
}
&install_executable($bindir, $potential_targets[0]);

